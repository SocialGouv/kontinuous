// Jest Snapshot v1, https://goo.gl/fbAQLP

exports[`test build manifests with snapshots sample-1.prod 1`] = `
"apiVersion: v1
kind: Namespace
metadata:
  annotations:
    field.cattle.io/projectId: \\"1234\\"
    kontinuous/gitBranch: feature-branch-1
    kontinuous/mainNamespace: \\"true\\"
    kapp.k14s.io/exists: \\"\\"
    kontinuous/chartPath: project.fabrique.contrib.rancher-namespace
    kontinuous/source: project/charts/fabrique/charts/contrib/charts/rancher-namespace/templates/namespace.yaml
    kontinuous/deployment: test-sample-1-feature-branch-1-ffac537e6cbbf934b08745-5y3s29fx
  labels:
    application: test-sample-1
    kontinuous/deployment: test-sample-1-feature-branch-1-ffac537e6cbbf934b08745-5y3s29fx
    kontinuous/deployment.env: test-sample-1-prod
    kontinuous/ref: feature-branch-1
    kontinuous/gitSha: ffac537e6cbbf934b08745a378932722df287a53
    kontinuous/appVersion: ffac537e6cbbf934b08745a378932722df287a53
    kontinuous/resourceName: namespace-test-sample-1-6ayuq843
    app.kubernetes.io/manifest-managed-by: kontinuous
    app.kubernetes.io/manifest-created-by: kontinuous
  name: test-sample-1
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: netpol-ingress
  namespace: test-sample-1
  annotations:
    kontinuous/chartPath: project.fabrique.contrib.security-policies
    kontinuous/source: project/charts/fabrique/charts/contrib/charts/security-policies/templates/network-policy.yml
    kontinuous/deployment: test-sample-1-feature-branch-1-ffac537e6cbbf934b08745-5y3s29fx
  labels:
    kontinuous/deployment: test-sample-1-feature-branch-1-ffac537e6cbbf934b08745-5y3s29fx
    kontinuous/deployment.env: test-sample-1-prod
    kontinuous/ref: feature-branch-1
    kontinuous/gitSha: ffac537e6cbbf934b08745a378932722df287a53
    kontinuous/appVersion: ffac537e6cbbf934b08745a378932722df287a53
    kontinuous/resourceName: networkpolicy-netpol-ingress-61ndxljw
    app.kubernetes.io/manifest-managed-by: kontinuous
    app.kubernetes.io/manifest-created-by: kontinuous
spec:
  ingress:
    - from:
        - podSelector: {}
    - from:
        - namespaceSelector:
            matchLabels:
              network-policy/source: ingress-controller
    - from:
        - namespaceSelector:
            matchLabels:
              network-policy/source: monitoring
  podSelector: {}
  policyTypes:
    - Ingress
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: default
  annotations:
    kontinuous/chartPath: project.fabrique.contrib.security-policies
    kontinuous/source: project/charts/fabrique/charts/contrib/charts/security-policies/templates/service-account.yaml
    kontinuous/deployment: test-sample-1-feature-branch-1-ffac537e6cbbf934b08745-5y3s29fx
  labels:
    kontinuous/deployment: test-sample-1-feature-branch-1-ffac537e6cbbf934b08745-5y3s29fx
    kontinuous/deployment.env: test-sample-1-prod
    kontinuous/ref: feature-branch-1
    kontinuous/gitSha: ffac537e6cbbf934b08745a378932722df287a53
    kontinuous/appVersion: ffac537e6cbbf934b08745a378932722df287a53
    kontinuous/resourceName: serviceaccount-default-2g5dmk74
    app.kubernetes.io/manifest-managed-by: kontinuous
    app.kubernetes.io/manifest-created-by: kontinuous
  namespace: test-sample-1
automountServiceAccountToken: false
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: pgweb
  labels:
    helm.sh/chart: pgweb-1.9.5
    app.kubernetes.io/name: pgweb
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
    kontinuous/deployment: test-sample-1-feature-branch-1-ffac537e6cbbf934b08745-5y3s29fx
    kontinuous/deployment.env: test-sample-1-prod
    kontinuous/ref: feature-branch-1
    kontinuous/gitSha: ffac537e6cbbf934b08745a378932722df287a53
    kontinuous/appVersion: ffac537e6cbbf934b08745a378932722df287a53
    kontinuous/resourceName: serviceaccount-pgweb-3b1nl9ny
    app.kubernetes.io/manifest-managed-by: kontinuous
    app.kubernetes.io/manifest-created-by: kontinuous
  annotations:
    kontinuous/chartPath: project.fabrique.pgweb.pgweb
    kontinuous/source: project/charts/fabrique/charts/pgweb/charts/pgweb/templates/serviceaccount.yaml
    kontinuous/deployment: test-sample-1-feature-branch-1-ffac537e6cbbf934b08745-5y3s29fx
  namespace: test-sample-1
---
kind: ConfigMap
apiVersion: v1
metadata:
  name: app-configmap
  annotations:
    kontinuous/chartPath: project
    kontinuous/source: project/templates/app.configmap.yaml
    kontinuous/deployment: test-sample-1-feature-branch-1-ffac537e6cbbf934b08745-5y3s29fx
  labels:
    kontinuous/deployment: test-sample-1-feature-branch-1-ffac537e6cbbf934b08745-5y3s29fx
    kontinuous/deployment.env: test-sample-1-prod
    kontinuous/ref: feature-branch-1
    kontinuous/gitSha: ffac537e6cbbf934b08745a378932722df287a53
    kontinuous/appVersion: ffac537e6cbbf934b08745a378932722df287a53
    kontinuous/resourceName: configmap-app-configmap-519shm91
    app.kubernetes.io/manifest-managed-by: kontinuous
    app.kubernetes.io/manifest-created-by: kontinuous
  namespace: test-sample-1
data:
  NODE_ENV: production
  GRAPHQL_ENDPOINT: http://hasura/v1/graphql
  ACCOUNT_MAIL_SENDER: contact@fabrique.social.gouv.fr
  PRODUCTION: \\"true\\"
---
apiVersion: bitnami.com/v1alpha1
kind: SealedSecret
metadata:
  name: hasura-sealed-secret
  annotations:
    kontinuous/chartPath: project
    kontinuous/source: project/templates/hasura.sealed-secret.yaml
    kontinuous/deployment: test-sample-1-feature-branch-1-ffac537e6cbbf934b08745-5y3s29fx
  labels:
    kontinuous/deployment: test-sample-1-feature-branch-1-ffac537e6cbbf934b08745-5y3s29fx
    kontinuous/deployment.env: test-sample-1-prod
    kontinuous/ref: feature-branch-1
    kontinuous/gitSha: ffac537e6cbbf934b08745a378932722df287a53
    kontinuous/appVersion: ffac537e6cbbf934b08745a378932722df287a53
    kontinuous/resourceName: sealedsecret-hasura-sealed-secret-2cipvz77
    app.kubernetes.io/manifest-managed-by: kontinuous
    app.kubernetes.io/manifest-created-by: kontinuous
  namespace: test-sample-1
spec:
  encryptedData:
    ACCOUNT_EMAIL_SECRET: AgBc+UqJhU2ZBfuplyiI3pPekRjm36i62WYR1lVpM9PIwK636R78mpfckIeGU09qKAxWGYBqtYtvNP3lTG8OwEUqKLnUxZPZKbtwc78GwzEzaPpnWmM+j78uBDxqHDiW+jKwnD/6XiWxsfyd1ZU/qS0LDEJBnVRoDyUI0NxzFWLxG8ylr6oK3q+oD3338D588TimklZGOvRm/hI95d5uwKsYPz0zYOj28pgHzNMVycreOXi9l562agyg2hdb8AkFD41utLEURxJOomJUl2xZIjv6FX++R9OJQzRsX6WsCAkLZPO7VEi1cvG6QzPf/uchwystfQfW5c+5ofVJer5mLJJjFcO8OfNbsg/JYlndv4F90cjH2dojSHv/qH/ddpObPgkDpVzCljdTvrir5bl3z3KeqLb20ja1hLJlwOue4zHDCQ6Fwza8VN6BjbHZLYhOO5qlYfWezjwt+B6RdFVzD8wu2JbuWsJo5w2HhMl2Nckar1B8CPxzgRXnFwc/QsFTDXOXX+rtxnC4FJfffZ/2frV745c642AhOArDxk8OGDFkrexr5OMv0iJcY15cl6K9dfZWOKfFd5mxfWFhDWUSAoUZJsz4uVxpTCCoSJBe8Nf1aKk7PkZ+bXtV5bpuktySoPh0hG1M1dUg0WsSC2i6zp75AUxVW6c4GG7d9FMsTHIwyD7fEbV3TMRanSRFYNPOmft/oI7Q3oNGOGg26KCtX414FG02EnpmrttHQguY7cnHGG7i7s8mnyGv
    HASURA_GRAPHQL_ADMIN_SECRET: AgAQ9npiVSZcI8IA6kHHQ9tMaKYahCPmiYh9PoEmKIvisGCM4hQ2Q+UUoUvA2N3Id/GCxNZh3hqmTjLp+mHPy0e8rr9+/WVB5jrrqWO/oX2R1kXq0dbITF27UOjmTaUkZefPf7diHKpCXKGamkP6YbVuZa+1BBmBBfkIDJsraKO1CS/EO0QZAb0fHJiOkNy30j4pTTlg16JdugEj3kXdXXXZD/F8OyvlLBY1jivC/uFMGppNh1eRivgi4Y+krCDCuLphAa5YVslLMf7bboDD5Tk1b2HOCNYxQ96dxvkqCVtNd2rxXfDsYy9vMbQfYnsBjsIT7VZhk3GaMpVmPTRjp89XQDvj86+PrPtuFlgmfLrNvbvcqJ30y5lkD46c4Bd9zgwN4FeeVuY/oCKgfrN1qdCOT+ZYchkVQuCbKT+qK0gfOkYRt+B5feL5MtaEXX2MyhPS8wCvNLyAEth6NbmYxdXOPBXQrfGNcZYg/qjeB/muAzkd4wEPsR9ExoY5envlJ8Mx8LUQ/7A2tRp1jd+uy8s1hdb94BgOhcCqgzdqRkIVp40GiVHzVkFWQEkMEoX1Mw4iifs0QtAZu8qPyFWYORf9fty8zG/WX0RStdYbTuahCLb+Vqs2A5UEbg8nRdfl16aZJ3RY2fIoF1kYNG7XiZmp+bltOOqvYcOBnAr3Dy/y1PV1NrBMCULxibM57+nRyXrJe6TYLrJWPnp7meLLKppKPN3tgvx21s1/8bpbxC0xgshPZFgXQXgB
    HASURA_GRAPHQL_JWT_SECRET: AgAyuiPLqj0UMvhEkyEGF04LOp8al2O59/YGOei4hfkqcEw83rmJnb/o3nz96oLYG4gX/JlMT8grhUmR8wPG+Ah5UDuGK9POP75YYyNDQ05FrMDPCjQtEXNslqNp+oVS91ONUwJ7ARUr47vfQdxRoK03cFCboY0wEF8HMZzRjn5fXccttyT21kJV75Y0MtCif5jNCj+gtX2DIP9dNfvAJKCvOCzNJDALLmhv4tY71ZquGAiXf/+mJVP5ugRjFL0wYoKThAr3vph5cOPUo44swVilESu54gAoRlPNxFgOBXHS5Uu0VWryzTJyQGOElkYCxyBC45YzFZGMB3RWxaZtuForw76bD0RYWTVNsI+N/KmZdbYZO5Cs6HdqE2nptb3QAgpH0JOeWnzZGxTmkSOpEwCUGCJG+7ApPB5obIaVMZG39lWvZc/VTBZkTr7ufvOyIvwtYc9eh+AiNSy02gUXMzIkxK/eyWmKXowJcqXYK8K9iIgkLfMclUdWFQtHCN0h4OEyenRreP9qX8E34eeZ1ZwiDgJGOki8Ys4bphaFjSXZd82KRwuHDTIamAEGCUm7rLW9yOGE77AJpBTdqt2Qz9SUCXWbJewukbvtZwVtAEpEI/O+/KKNinObH0Lmhj8bRLn01rLgt9WsB972vEjboyzkT2gC7/G2Nx8O3IFiiJ9Ki5/hko5A4oorXdkCfuP7UfiKFR/pkXKqCOMrqi7uD7N0/qNtZ2j3satfeInOEldn1M6h7mz2IiRdszxq/RTsdFEO6h3X3lZLELXcDjgkZqCMXaPToAPRS2EKi6Ihs151VepGAerGOeq+DL+NU1aOwenivXe91vqDm9O0Cc3K756VBkUZA7ufFp3RKujk5fWygk0N8w0Zd9qU/tL7NqE/5n8xIdknzBI+qoHCrrOTnyMUpUEPuYbxY2lYkhb/4Afzte2nyM0K50I/4imEYWVsC+vNQ59OeYCoYcJBe19D+dm2rfxvYgy/H7scFjsl9rwCe23aPWQOJBJvcEnmgKOMRkG0cw6gvhBPVZ2w8gvIAfffLsj+zsag1izfgzcaajrfRr/kkxYk6R6Gz5tdjYSUz6P1Xk8LyCyB6st9IE433qlel4bwxjwh1CYz3pGUvAwj+TKsAF4xeiFd/LN3nitE74yGAOerbB/MrQqCcGbD6Anz2DWaFkhRxYKlJQsyy1rsxPzfo2wr8W/zpX7Jf17fHXJ96OG/WV2uZvudw7EjVdvxLhauabodjh3eC1/Kn9yvxJ5GTQLjJ04C/o7QgiIz+vNyxSqfvWf6zAsPJrAoHZXXoPbOaZVG2Sx1eWrhEIi8eV2z1x54SKLM0yy8lRTc2170AhLxqf4PaDTMR4ZTkhaIwPONeAIdHGnk3DVgYa/97WNO3j48ZnXwjKvp8mcKoe2Q9Y3WYuu4XafZg9UdDLbtePJiBlSF42uUbZsS4/oEU8ErRyodcOQPUYEM5SGuxceTvyxi6v7zhgYv3TiwWGgkoxznvFZ9H8m3SN0hCY4TINo9bnBAm2XRzZrhmGRpoKTOvQbkIXKoOzKeoQRgopjUdWW5X4EcKOW76X7B20x+2sPVkqwN/u5KFX3+HY3z1ui1+nIIKlbjUCY17QwxuVDP7yMU6xeBhtwUz0FkFGyHuSbrk+NhpA==
  template:
    metadata:
      name: hasura-sealed-secret
    type: Opaque
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    component: app-2nd-instance
    application: test-sample-1
    kontinuous/deployment: test-sample-1-feature-branch-1-ffac537e6cbbf934b08745-5y3s29fx
    kontinuous/deployment.env: test-sample-1-prod
    kontinuous/ref: feature-branch-1
    kontinuous/gitSha: ffac537e6cbbf934b08745a378932722df287a53
    kontinuous/appVersion: ffac537e6cbbf934b08745a378932722df287a53
    kontinuous/resourceName: deployment-app-2nd-instance-1yps0u02
    app.kubernetes.io/manifest-managed-by: kontinuous
    app.kubernetes.io/manifest-created-by: kontinuous
  name: app-2nd-instance
  namespace: test-sample-1
  annotations:
    kontinuous/chartPath: project.fabrique.contrib.app-2nd-instance
    kontinuous/source: project/charts/fabrique/charts/contrib/charts/app-2nd-instance/templates/deployment.yaml
    kontinuous/deployment: test-sample-1-feature-branch-1-ffac537e6cbbf934b08745-5y3s29fx
    kontinuous/depname.full: project.fabrique.contrib.app-2nd-instance.deployment.app-2nd-instance
    kontinuous/depname.chartResource: app-2nd-instance.deployment.app-2nd-instance
    kontinuous/depname.chartName: app-2nd-instance
    kontinuous/depname.chartPath: project.fabrique.contrib.app-2nd-instance
    kontinuous/depname.resourcePath: deployment.app-2nd-instance
    kontinuous/depname.resourceName: app-2nd-instance
    kontinuous/depname.chartNameTopFull: app-2nd-instance
    kontinuous/depname.chartNameTop: app-2nd-instance
    kontinuous/plugin.log: \\"false\\"
    reloader.stakater.com/auto: \\"true\\"
spec:
  replicas: 2
  selector:
    matchLabels:
      component: app-2nd-instance
  strategy:
    type: RollingUpdate
  template:
    metadata:
      labels:
        component: app-2nd-instance
        application: test-sample-1
        namespace: test-sample-1
        kontinuous/deployment: test-sample-1-feature-branch-1-ffac537e6cbbf934b08745-5y3s29fx
        kontinuous/deployment.env: test-sample-1-prod
        kontinuous/ref: feature-branch-1
        kontinuous/gitSha: ffac537e6cbbf934b08745a378932722df287a53
        kontinuous/appVersion: ffac537e6cbbf934b08745a378932722df287a53
        kontinuous/resourceName: deployment-app-2nd-instance-1yps0u02
        app.kubernetes.io/manifest-managed-by: kontinuous
        app.kubernetes.io/manifest-created-by: kontinuous
      annotations:
        kontinuous/deployment: test-sample-1-feature-branch-1-ffac537e6cbbf934b08745-5y3s29fx
    spec:
      affinity:
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
            - weight: 1
              podAffinityTerm:
                labelSelector:
                  matchExpressions:
                    - key: namespace
                      operator: In
                      values:
                        - test-sample-1
                    - key: component
                      operator: In
                      values:
                        - app-2nd-instance
                topologyKey: kubernetes.io/hostname
      containers:
        - image: harbor.fabrique.social.gouv.fr/test-sample-1/app:prod
          name: app
          ports:
            - containerPort: 3000
              name: http
          livenessProbe:
            failureThreshold: 15
            httpGet:
              path: /healthz
              port: http
            initialDelaySeconds: 30
            periodSeconds: 5
            timeoutSeconds: 5
          readinessProbe:
            exec:
              command:
                - cat
                - /var/run/readiness-check/readiness-file
            initialDelaySeconds: 5
            periodSeconds: 5
          startupProbe:
            failureThreshold: 20
            httpGet:
              path: /healthz
              port: http
            initialDelaySeconds: 10
            periodSeconds: 10
            timeoutSeconds: 5
          resources:
            limits: {}
            requests: {}
          envFrom:
            - secretRef:
                name: pg-user
            - secretRef:
                name: app-sealed-secret
            - configMapRef:
                name: app-configmap
          lifecycle:
            postStart:
              exec:
                command:
                  - sh
                  - -c
                  - touch /var/run/readiness-check/readiness-file
            preStop:
              exec:
                command:
                  - sh
                  - -c
                  - rm -f /var/run/readiness-check/readiness-file; sleep 30
          volumeMounts:
            - name: readiness-check-volume
              mountPath: /var/run/readiness-check
      volumes:
        - name: readiness-check-volume
          emptyDir: {}
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    component: app
    application: test-sample-1
    kontinuous/deployment: test-sample-1-feature-branch-1-ffac537e6cbbf934b08745-5y3s29fx
    kontinuous/deployment.env: test-sample-1-prod
    kontinuous/ref: feature-branch-1
    kontinuous/gitSha: ffac537e6cbbf934b08745a378932722df287a53
    kontinuous/appVersion: ffac537e6cbbf934b08745a378932722df287a53
    kontinuous/resourceName: deployment-app-55fzcjih
    app.kubernetes.io/manifest-managed-by: kontinuous
    app.kubernetes.io/manifest-created-by: kontinuous
  name: app
  namespace: test-sample-1
  annotations:
    kontinuous/chartPath: project.fabrique.contrib.app
    kontinuous/source: project/charts/fabrique/charts/contrib/charts/app/templates/deployment.yaml
    kontinuous/deployment: test-sample-1-feature-branch-1-ffac537e6cbbf934b08745-5y3s29fx
    kontinuous/depname.full: project.fabrique.contrib.app.deployment.app
    kontinuous/depname.chartResource: app.deployment.app
    kontinuous/depname.chartName: app
    kontinuous/depname.chartPath: project.fabrique.contrib.app
    kontinuous/depname.resourcePath: deployment.app
    kontinuous/depname.resourceName: app
    kontinuous/depname.chartNameTopFull: app
    kontinuous/depname.chartNameTop: app
    kontinuous/plugin.log: \\"false\\"
    reloader.stakater.com/auto: \\"true\\"
spec:
  replicas: 2
  selector:
    matchLabels:
      component: app
  strategy:
    type: RollingUpdate
  template:
    metadata:
      labels:
        component: app
        application: test-sample-1
        namespace: test-sample-1
        kontinuous/deployment: test-sample-1-feature-branch-1-ffac537e6cbbf934b08745-5y3s29fx
        kontinuous/deployment.env: test-sample-1-prod
        kontinuous/ref: feature-branch-1
        kontinuous/gitSha: ffac537e6cbbf934b08745a378932722df287a53
        kontinuous/appVersion: ffac537e6cbbf934b08745a378932722df287a53
        kontinuous/resourceName: deployment-app-55fzcjih
        app.kubernetes.io/manifest-managed-by: kontinuous
        app.kubernetes.io/manifest-created-by: kontinuous
      annotations:
        kontinuous/deployment: test-sample-1-feature-branch-1-ffac537e6cbbf934b08745-5y3s29fx
    spec:
      affinity:
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
            - weight: 1
              podAffinityTerm:
                labelSelector:
                  matchExpressions:
                    - key: namespace
                      operator: In
                      values:
                        - test-sample-1
                    - key: component
                      operator: In
                      values:
                        - app
                topologyKey: kubernetes.io/hostname
      containers:
        - image: harbor.fabrique.social.gouv.fr/test-sample-1/app:prod
          name: app
          ports:
            - containerPort: 3000
              name: http
          livenessProbe:
            failureThreshold: 15
            httpGet:
              path: /healthz
              port: http
            initialDelaySeconds: 30
            periodSeconds: 5
            timeoutSeconds: 5
          readinessProbe:
            exec:
              command:
                - cat
                - /var/run/readiness-check/readiness-file
            initialDelaySeconds: 5
            periodSeconds: 5
          startupProbe:
            failureThreshold: 20
            httpGet:
              path: /healthz
              port: http
            initialDelaySeconds: 10
            periodSeconds: 10
            timeoutSeconds: 5
          resources:
            limits: {}
            requests: {}
          envFrom:
            - secretRef:
                name: pg-user
            - secretRef:
                name: app-sealed-secret
            - configMapRef:
                name: app-configmap
          lifecycle:
            postStart:
              exec:
                command:
                  - sh
                  - -c
                  - touch /var/run/readiness-check/readiness-file
            preStop:
              exec:
                command:
                  - sh
                  - -c
                  - rm -f /var/run/readiness-check/readiness-file; sleep 30
          volumeMounts:
            - name: readiness-check-volume
              mountPath: /var/run/readiness-check
      volumes:
        - name: readiness-check-volume
          emptyDir: {}
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    component: hasura
    application: test-sample-1
    kontinuous/deployment: test-sample-1-feature-branch-1-ffac537e6cbbf934b08745-5y3s29fx
    kontinuous/deployment.env: test-sample-1-prod
    kontinuous/ref: feature-branch-1
    kontinuous/gitSha: ffac537e6cbbf934b08745a378932722df287a53
    kontinuous/appVersion: ffac537e6cbbf934b08745a378932722df287a53
    kontinuous/resourceName: deployment-hasura-3fivxu5u
    app.kubernetes.io/manifest-managed-by: kontinuous
    app.kubernetes.io/manifest-created-by: kontinuous
  name: hasura
  namespace: test-sample-1
  annotations:
    kontinuous/chartPath: project.fabrique.contrib.hasura
    kontinuous/source: project/charts/fabrique/charts/contrib/charts/hasura/templates/deployment.yaml
    kontinuous/deployment: test-sample-1-feature-branch-1-ffac537e6cbbf934b08745-5y3s29fx
    kontinuous/depname.full: project.fabrique.contrib.hasura.deployment.hasura
    kontinuous/depname.chartResource: hasura.deployment.hasura
    kontinuous/depname.chartName: hasura
    kontinuous/depname.chartPath: project.fabrique.contrib.hasura
    kontinuous/depname.resourcePath: deployment.hasura
    kontinuous/depname.resourceName: hasura
    kontinuous/depname.chartNameTopFull: hasura
    kontinuous/depname.chartNameTop: hasura
    kontinuous/plugin.log: \\"false\\"
    reloader.stakater.com/auto: \\"true\\"
spec:
  replicas: 2
  selector:
    matchLabels:
      component: hasura
  template:
    metadata:
      labels:
        component: hasura
        application: test-sample-1
        kontinuous/deployment: test-sample-1-feature-branch-1-ffac537e6cbbf934b08745-5y3s29fx
        kontinuous/deployment.env: test-sample-1-prod
        kontinuous/ref: feature-branch-1
        kontinuous/gitSha: ffac537e6cbbf934b08745a378932722df287a53
        kontinuous/appVersion: ffac537e6cbbf934b08745a378932722df287a53
        kontinuous/resourceName: deployment-hasura-3fivxu5u
        app.kubernetes.io/manifest-managed-by: kontinuous
        app.kubernetes.io/manifest-created-by: kontinuous
      annotations:
        kontinuous/deployment: test-sample-1-feature-branch-1-ffac537e6cbbf934b08745-5y3s29fx
    spec:
      containers:
        - image: harbor.fabrique.social.gouv.fr/test-sample-1/hasura:prod
          name: hasura
          ports:
            - containerPort: 8080
              name: http
          resources:
            limits: {}
            requests: {}
          livenessProbe:
            httpGet:
              path: /healthz
              port: http
            failureThreshold: 15
            initialDelaySeconds: 30
            periodSeconds: 5
            successThreshold: 1
            timeoutSeconds: 5
          readinessProbe:
            exec:
              command:
                - cat
                - /var/run/readiness-check/readiness-file
            initialDelaySeconds: 5
            periodSeconds: 5
          startupProbe:
            httpGet:
              path: /healthz
              port: http
            failureThreshold: 60
            initialDelaySeconds: 30
            periodSeconds: 10
            successThreshold: 1
            timeoutSeconds: 1
          env:
            - name: HASURA_GRAPHQL_MIGRATIONS_SERVER_TIMEOUT
              value: \\"360\\"
          envFrom:
            - secretRef:
                name: pg-user
            - secretRef:
                name: hasura-sealed-secret
            - configMapRef:
                name: hasura-configmap
          lifecycle:
            postStart:
              exec:
                command:
                  - sh
                  - -c
                  - touch /var/run/readiness-check/readiness-file
            preStop:
              exec:
                command:
                  - sh
                  - -c
                  - rm -f /var/run/readiness-check/readiness-file; sleep 30
          volumeMounts:
            - name: readiness-check-volume
              mountPath: /var/run/readiness-check
      volumes:
        - name: readiness-check-volume
          emptyDir: {}
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: pgweb
  labels:
    helm.sh/chart: pgweb-1.9.5
    app.kubernetes.io/name: pgweb
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
    kontinuous/deployment: test-sample-1-feature-branch-1-ffac537e6cbbf934b08745-5y3s29fx
    kontinuous/deployment.env: test-sample-1-prod
    kontinuous/ref: feature-branch-1
    kontinuous/gitSha: ffac537e6cbbf934b08745a378932722df287a53
    kontinuous/appVersion: ffac537e6cbbf934b08745a378932722df287a53
    kontinuous/resourceName: deployment-pgweb-5afr2ikf
    app.kubernetes.io/manifest-managed-by: kontinuous
    app.kubernetes.io/manifest-created-by: kontinuous
  annotations:
    kontinuous/chartPath: project.fabrique.pgweb.pgweb
    kontinuous/source: project/charts/fabrique/charts/pgweb/charts/pgweb/templates/deployment.yaml
    kontinuous/deployment: test-sample-1-feature-branch-1-ffac537e6cbbf934b08745-5y3s29fx
    kontinuous/depname.full: project.fabrique.pgweb.pgweb.deployment.pgweb
    kontinuous/depname.chartResource: pgweb.deployment.pgweb
    kontinuous/depname.chartName: pgweb
    kontinuous/depname.chartPath: project.fabrique.pgweb.pgweb
    kontinuous/depname.resourcePath: deployment.pgweb
    kontinuous/depname.resourceName: pgweb
    kontinuous/depname.chartNameTopFull: pgweb.pgweb
    kontinuous/depname.chartNameTop: pgweb
    kontinuous/plugin.log: \\"false\\"
    reloader.stakater.com/auto: \\"true\\"
  namespace: test-sample-1
spec:
  replicas: 1
  selector:
    matchLabels:
      component: pgweb
  template:
    metadata:
      labels:
        component: pgweb
        app.kubernetes.io/name: pgweb
        app.kubernetes.io/instance: release-name
        kontinuous/deployment: test-sample-1-feature-branch-1-ffac537e6cbbf934b08745-5y3s29fx
        kontinuous/deployment.env: test-sample-1-prod
        kontinuous/ref: feature-branch-1
        kontinuous/gitSha: ffac537e6cbbf934b08745a378932722df287a53
        kontinuous/appVersion: ffac537e6cbbf934b08745a378932722df287a53
        kontinuous/resourceName: deployment-pgweb-5afr2ikf
        app.kubernetes.io/manifest-managed-by: kontinuous
        app.kubernetes.io/manifest-created-by: kontinuous
      annotations:
        kontinuous/deployment: test-sample-1-feature-branch-1-ffac537e6cbbf934b08745-5y3s29fx
    spec:
      serviceAccountName: pgweb
      securityContext:
        fsGroup: 1000
        runAsGroup: 1000
        runAsUser: 1000
      containers:
        - name: pgweb
          securityContext:
            allowPrivilegeEscalation: false
          image: sosedoff/pgweb:0.14.1
          imagePullPolicy: IfNotPresent
          ports:
            - name: http
              containerPort: 8081
              protocol: TCP
          livenessProbe:
            httpGet:
              path: /
              port: http
          readinessProbe:
            exec:
              command:
                - cat
                - /var/run/readiness-check/readiness-file
            initialDelaySeconds: 5
            periodSeconds: 5
          resources: {}
          lifecycle:
            postStart:
              exec:
                command:
                  - sh
                  - -c
                  - touch /var/run/readiness-check/readiness-file
            preStop:
              exec:
                command:
                  - sh
                  - -c
                  - rm -f /var/run/readiness-check/readiness-file; sleep 30
          volumeMounts:
            - name: readiness-check-volume
              mountPath: /var/run/readiness-check
      volumes:
        - name: readiness-check-volume
          emptyDir: {}
---
apiVersion: v1
kind: Service
metadata:
  labels:
    component: app-2nd-instance
    application: test-sample-1
    kontinuous/deployment: test-sample-1-feature-branch-1-ffac537e6cbbf934b08745-5y3s29fx
    kontinuous/deployment.env: test-sample-1-prod
    kontinuous/ref: feature-branch-1
    kontinuous/gitSha: ffac537e6cbbf934b08745a378932722df287a53
    kontinuous/appVersion: ffac537e6cbbf934b08745a378932722df287a53
    kontinuous/resourceName: service-app-2nd-instance-3rnz4xkc
    app.kubernetes.io/manifest-managed-by: kontinuous
    app.kubernetes.io/manifest-created-by: kontinuous
  name: app-2nd-instance
  namespace: test-sample-1
  annotations:
    kontinuous/chartPath: project.fabrique.contrib.app-2nd-instance
    kontinuous/source: project/charts/fabrique/charts/contrib/charts/app-2nd-instance/templates/service.yaml
    kontinuous/deployment: test-sample-1-feature-branch-1-ffac537e6cbbf934b08745-5y3s29fx
spec:
  ports:
    - name: http
      port: 80
      targetPort: 3000
  selector:
    component: app-2nd-instance
  type: ClusterIP
---
apiVersion: v1
kind: Service
metadata:
  labels:
    component: app
    application: test-sample-1
    kontinuous/deployment: test-sample-1-feature-branch-1-ffac537e6cbbf934b08745-5y3s29fx
    kontinuous/deployment.env: test-sample-1-prod
    kontinuous/ref: feature-branch-1
    kontinuous/gitSha: ffac537e6cbbf934b08745a378932722df287a53
    kontinuous/appVersion: ffac537e6cbbf934b08745a378932722df287a53
    kontinuous/resourceName: service-app-46z2o1vv
    app.kubernetes.io/manifest-managed-by: kontinuous
    app.kubernetes.io/manifest-created-by: kontinuous
  name: app
  namespace: test-sample-1
  annotations:
    kontinuous/chartPath: project.fabrique.contrib.app
    kontinuous/source: project/charts/fabrique/charts/contrib/charts/app/templates/service.yaml
    kontinuous/deployment: test-sample-1-feature-branch-1-ffac537e6cbbf934b08745-5y3s29fx
spec:
  ports:
    - name: http
      port: 80
      targetPort: 3000
  selector:
    component: app
  type: ClusterIP
---
apiVersion: v1
kind: Service
metadata:
  labels:
    component: hasura
    application: test-sample-1
    kontinuous/deployment: test-sample-1-feature-branch-1-ffac537e6cbbf934b08745-5y3s29fx
    kontinuous/deployment.env: test-sample-1-prod
    kontinuous/ref: feature-branch-1
    kontinuous/gitSha: ffac537e6cbbf934b08745a378932722df287a53
    kontinuous/appVersion: ffac537e6cbbf934b08745a378932722df287a53
    kontinuous/resourceName: service-hasura-2b56e0cf
    app.kubernetes.io/manifest-managed-by: kontinuous
    app.kubernetes.io/manifest-created-by: kontinuous
  name: hasura
  namespace: test-sample-1
  annotations:
    kontinuous/chartPath: project.fabrique.contrib.hasura
    kontinuous/source: project/charts/fabrique/charts/contrib/charts/hasura/templates/service.yaml
    kontinuous/deployment: test-sample-1-feature-branch-1-ffac537e6cbbf934b08745-5y3s29fx
spec:
  ports:
    - name: http
      port: 80
      targetPort: 8080
  selector:
    component: hasura
  type: ClusterIP
---
apiVersion: v1
kind: Service
metadata:
  labels:
    component: pgweb
    application: test-sample-1
    kontinuous/deployment: test-sample-1-feature-branch-1-ffac537e6cbbf934b08745-5y3s29fx
    kontinuous/deployment.env: test-sample-1-prod
    kontinuous/ref: feature-branch-1
    kontinuous/gitSha: ffac537e6cbbf934b08745a378932722df287a53
    kontinuous/appVersion: ffac537e6cbbf934b08745a378932722df287a53
    kontinuous/resourceName: service-pgweb-2rlshjo0
    app.kubernetes.io/manifest-managed-by: kontinuous
    app.kubernetes.io/manifest-created-by: kontinuous
  name: pgweb
  annotations:
    kontinuous/chartPath: project.fabrique.pgweb.pgweb
    kontinuous/source: project/charts/fabrique/charts/pgweb/charts/pgweb/templates/service.yaml
    kontinuous/deployment: test-sample-1-feature-branch-1-ffac537e6cbbf934b08745-5y3s29fx
  namespace: test-sample-1
spec:
  ports:
    - name: http
      port: 80
      targetPort: 8081
  selector:
    component: pgweb
  type: ClusterIP
---
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: app-2nd-instance
  namespace: test-sample-1
  labels:
    component: app-2nd-instance
    kontinuous/deployment: test-sample-1-feature-branch-1-ffac537e6cbbf934b08745-5y3s29fx
    kontinuous/deployment.env: test-sample-1-prod
    kontinuous/ref: feature-branch-1
    kontinuous/gitSha: ffac537e6cbbf934b08745a378932722df287a53
    kontinuous/appVersion: ffac537e6cbbf934b08745a378932722df287a53
    kontinuous/resourceName: horizontalpodautoscaler-app-2nd-instance-2v068zao
    app.kubernetes.io/manifest-managed-by: kontinuous
    app.kubernetes.io/manifest-created-by: kontinuous
  annotations:
    kontinuous/chartPath: project.fabrique.contrib.app-2nd-instance
    kontinuous/source: project/charts/fabrique/charts/contrib/charts/app-2nd-instance/templates/autoscaler.yaml
    kontinuous/deployment: test-sample-1-feature-branch-1-ffac537e6cbbf934b08745-5y3s29fx
spec:
  minReplicas: 2
  maxReplicas: 10
  metrics:
    - resource:
        name: cpu
        target:
          averageUtilization: 80
          type: Utilization
      type: Resource
    - resource:
        name: memory
        target:
          averageUtilization: 80
          type: Utilization
      type: Resource
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: app-2nd-instance
---
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: app
  namespace: test-sample-1
  labels:
    component: app
    kontinuous/deployment: test-sample-1-feature-branch-1-ffac537e6cbbf934b08745-5y3s29fx
    kontinuous/deployment.env: test-sample-1-prod
    kontinuous/ref: feature-branch-1
    kontinuous/gitSha: ffac537e6cbbf934b08745a378932722df287a53
    kontinuous/appVersion: ffac537e6cbbf934b08745a378932722df287a53
    kontinuous/resourceName: horizontalpodautoscaler-app-5g3qm0bo
    app.kubernetes.io/manifest-managed-by: kontinuous
    app.kubernetes.io/manifest-created-by: kontinuous
  annotations:
    kontinuous/chartPath: project.fabrique.contrib.app
    kontinuous/source: project/charts/fabrique/charts/contrib/charts/app/templates/autoscaler.yaml
    kontinuous/deployment: test-sample-1-feature-branch-1-ffac537e6cbbf934b08745-5y3s29fx
spec:
  minReplicas: 2
  maxReplicas: 10
  metrics:
    - resource:
        name: cpu
        target:
          averageUtilization: 80
          type: Utilization
      type: Resource
    - resource:
        name: memory
        target:
          averageUtilization: 80
          type: Utilization
      type: Resource
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: app
---
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: hasura
  namespace: test-sample-1
  labels:
    component: hasura
    kontinuous/deployment: test-sample-1-feature-branch-1-ffac537e6cbbf934b08745-5y3s29fx
    kontinuous/deployment.env: test-sample-1-prod
    kontinuous/ref: feature-branch-1
    kontinuous/gitSha: ffac537e6cbbf934b08745a378932722df287a53
    kontinuous/appVersion: ffac537e6cbbf934b08745a378932722df287a53
    kontinuous/resourceName: horizontalpodautoscaler-hasura-2gwbp4ld
    app.kubernetes.io/manifest-managed-by: kontinuous
    app.kubernetes.io/manifest-created-by: kontinuous
  annotations:
    kontinuous/chartPath: project.fabrique.contrib.hasura
    kontinuous/source: project/charts/fabrique/charts/contrib/charts/hasura/templates/autoscaler.yaml
    kontinuous/deployment: test-sample-1-feature-branch-1-ffac537e6cbbf934b08745-5y3s29fx
spec:
  minReplicas: 2
  maxReplicas: 10
  metrics:
    - resource:
        name: cpu
        target:
          averageUtilization: 70
          type: Utilization
      type: Resource
    - resource:
        name: memory
        target:
          averageUtilization: 80
          type: Utilization
      type: Resource
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: hasura
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  labels:
    component: app-2nd-instance
    application: test-sample-1
    kontinuous/deployment: test-sample-1-feature-branch-1-ffac537e6cbbf934b08745-5y3s29fx
    kontinuous/deployment.env: test-sample-1-prod
    kontinuous/ref: feature-branch-1
    kontinuous/gitSha: ffac537e6cbbf934b08745a378932722df287a53
    kontinuous/appVersion: ffac537e6cbbf934b08745a378932722df287a53
    kontinuous/resourceName: ingress-app-2nd-instance-55am4zdx
    app.kubernetes.io/manifest-managed-by: kontinuous
    app.kubernetes.io/manifest-created-by: kontinuous
  name: app-2nd-instance
  namespace: test-sample-1
  annotations:
    kontinuous/chartPath: project.fabrique.contrib.app-2nd-instance
    kontinuous/source: project/charts/fabrique/charts/contrib/charts/app-2nd-instance/templates/ingress.yaml
    kontinuous/deployment: test-sample-1-feature-branch-1-ffac537e6cbbf934b08745-5y3s29fx
    cert-manager.io: cluster-issuer
    cert-manager.io/cluster-issuer: letsencrypt-prod
    kubernetes.io/tls-acme: \\"true\\"
spec:
  ingressClassName: nginx
  rules:
    - host: app-2nd-instance-test-sample-1.fabrique.social.gouv.fr
      http:
        paths:
          - backend:
              service:
                name: app-2nd-instance
                port:
                  name: http
            path: /
            pathType: Prefix
  tls:
    - hosts:
        - app-2nd-instance-test-sample-1.fabrique.social.gouv.fr
      secretName: app-2nd-instance-crt
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  annotations:
    nginx.ingress.kubernetes.io/configuration-snippet: >
      more_set_headers \\"Content-Security-Policy: default-src 'none'; connect-src
      'self' https://*.gouv.fr; font-src 'self'; img-src 'self'; prefetch-src
      'self' https://*.gouv.fr; script-src 'self' https://*.gouv.fr; frame-src
      'self' https://*.gouv.fr; style-src 'self' 'unsafe-inline'\\";

      more_set_headers \\"X-Frame-Options: deny\\";

      more_set_headers \\"X-XSS-Protection: 1; mode=block\\";

      more_set_headers \\"X-Content-Type-Options: nosniff\\";
    kontinuous/chartPath: project.fabrique.contrib.app
    kontinuous/source: project/charts/fabrique/charts/contrib/charts/app/templates/ingress.yaml
    kontinuous/deployment: test-sample-1-feature-branch-1-ffac537e6cbbf934b08745-5y3s29fx
    cert-manager.io: cluster-issuer
    cert-manager.io/cluster-issuer: letsencrypt-prod
    kubernetes.io/tls-acme: \\"true\\"
  labels:
    component: app
    application: test-sample-1
    kontinuous/deployment: test-sample-1-feature-branch-1-ffac537e6cbbf934b08745-5y3s29fx
    kontinuous/deployment.env: test-sample-1-prod
    kontinuous/ref: feature-branch-1
    kontinuous/gitSha: ffac537e6cbbf934b08745a378932722df287a53
    kontinuous/appVersion: ffac537e6cbbf934b08745a378932722df287a53
    kontinuous/resourceName: ingress-app-b4kcj2bx
    app.kubernetes.io/manifest-managed-by: kontinuous
    app.kubernetes.io/manifest-created-by: kontinuous
  name: app
  namespace: test-sample-1
spec:
  ingressClassName: nginx
  rules:
    - host: test-sample-1.fabrique.social.gouv.fr
      http:
        paths:
          - backend:
              service:
                name: app
                port:
                  name: http
            path: /
            pathType: Prefix
  tls:
    - hosts:
        - test-sample-1.fabrique.social.gouv.fr
      secretName: app-crt
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  labels:
    component: hasura
    application: test-sample-1
    kontinuous/deployment: test-sample-1-feature-branch-1-ffac537e6cbbf934b08745-5y3s29fx
    kontinuous/deployment.env: test-sample-1-prod
    kontinuous/ref: feature-branch-1
    kontinuous/gitSha: ffac537e6cbbf934b08745a378932722df287a53
    kontinuous/appVersion: ffac537e6cbbf934b08745a378932722df287a53
    kontinuous/resourceName: ingress-hasura-2784v1wj
    app.kubernetes.io/manifest-managed-by: kontinuous
    app.kubernetes.io/manifest-created-by: kontinuous
  name: hasura
  namespace: test-sample-1
  annotations:
    kontinuous/chartPath: project.fabrique.contrib.hasura
    kontinuous/source: project/charts/fabrique/charts/contrib/charts/hasura/templates/ingress.yaml
    kontinuous/deployment: test-sample-1-feature-branch-1-ffac537e6cbbf934b08745-5y3s29fx
    cert-manager.io: cluster-issuer
    cert-manager.io/cluster-issuer: letsencrypt-prod
    kubernetes.io/tls-acme: \\"true\\"
spec:
  ingressClassName: nginx
  rules:
    - host: hasura-test-sample-1.fabrique.social.gouv.fr
      http:
        paths:
          - backend:
              service:
                name: hasura
                port:
                  name: http
            path: /
            pathType: Prefix
  tls:
    - hosts:
        - hasura-test-sample-1.fabrique.social.gouv.fr
      secretName: hasura-crt
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  labels:
    component: pgweb
    application: test-sample-1
    kontinuous/deployment: test-sample-1-feature-branch-1-ffac537e6cbbf934b08745-5y3s29fx
    kontinuous/deployment.env: test-sample-1-prod
    kontinuous/ref: feature-branch-1
    kontinuous/gitSha: ffac537e6cbbf934b08745a378932722df287a53
    kontinuous/appVersion: ffac537e6cbbf934b08745a378932722df287a53
    kontinuous/resourceName: ingress-pgweb-2mnfw5rd
    app.kubernetes.io/manifest-managed-by: kontinuous
    app.kubernetes.io/manifest-created-by: kontinuous
  name: pgweb
  annotations:
    kontinuous/chartPath: project.fabrique.pgweb.pgweb
    kontinuous/source: project/charts/fabrique/charts/pgweb/charts/pgweb/templates/ingress.yaml
    kontinuous/deployment: test-sample-1-feature-branch-1-ffac537e6cbbf934b08745-5y3s29fx
    cert-manager.io: cluster-issuer
    cert-manager.io/cluster-issuer: letsencrypt-prod
    kubernetes.io/tls-acme: \\"true\\"
  namespace: test-sample-1
spec:
  rules:
    - host: pgweb-test-sample-1.fabrique.social.gouv.fr
      http:
        paths:
          - backend:
              service:
                name: pgweb
                port:
                  name: http
            path: /
            pathType: Prefix
  tls:
    - hosts:
        - pgweb-test-sample-1.fabrique.social.gouv.fr
      secretName: pgweb-crt
"
`;
