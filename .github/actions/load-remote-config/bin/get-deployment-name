#!/usr/bin/env node

const fs = require("fs")

// eslint-disable-next-line import/no-unresolved, import/no-absolute-path, import/extensions
const slug = require("/opt/kontinuous/packages/common/utils/slug")

let deploymentId

const jsonConfig = fs.readFileSync(process.env.KONTINUOUS_CONFIG)
const kontinuousConfig = JSON.parse(jsonConfig)

const { environment, repositoryName, gitBranch } = kontinuousConfig

if (process.argv[2]){
  deploymentId = slug(`${repositoryName}-${process.argv[2]}`)
} else {  
  if (environment === "prod") {
    deploymentId = "production"
  } else if (environment === "preprod") {
    deploymentId = "preprod"
  } else {
    deploymentId = slug(`${repositoryName}-${gitBranch}`)
  }
}

process.stdout.write(deploymentId)
