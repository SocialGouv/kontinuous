dependencies:
  contrib:
    import: socialgouv/kontinuous/plugins/contrib
    
    valuesCompilers:
      globalDefaults:
        enabled: true
        options:
          enableDefaultCharts: true

    patches:
      certs:
        enabled: true
      rancherProjectId:
        enabled: true
      reloader:
        enabled: true
      needsUsingInitcontainers:
        enabled: false
      kapp:
        enabled: false
      needsUsingKapp:
        enabled: false
      filterDisableKapp:
        enabled: true
      minimizeDevResourcesRequests:
        options:
          avoidOutOfpods: true
          avoidOutOfpodsMargin:
            cpu: 10m
            memory: 10Mi
          nodeConfig:
            maxPods: 110
            cpu: 7820m
            memory: 24505448Ki

    validators:
      rancherProjectId:
        enabled: true
      noPlainSecrets:
        enabled: true
      sealedSecrets:
        enabled: true

    preDeploy:
      rancherNamespaces:
        enabled: true
      cleanFailed:
        enabled: false

    postDeploy:
      notifyMattermost:
        enabled: true
        options:
          notifyWebhookUrlVarName: NOTIFY_WEBHOOK_URL
    
    deploySidecars:
      failfast:
        enabled: false
      stern:
        enabled: true
      progressing:
        enabled: true

    deployWith:
      kapp:
        options:
          kubeApiQps: 1000
          kubeApiBurst: 1000
          waitCheckInterval: 1s
          logsAll: true


config:
  webhookUri: https://kontinuous.fabrique.social.gouv.fr

options:
  kubernetesMethod: kubeconfig
  surviveOnBrokenCluster: true
  clusters:
    dev:
      kubesealEndpoint: "https://kubeseal.dev2.fabrique.social.gouv.fr"
      environments:
        - dev
        - preprod
    prod:
      kubesealEndpoint: "https://kubeseal.prod2.fabrique.social.gouv.fr"
      environments:
        - prod

  registry: "harbor.fabrique.social.gouv.fr"
  domain: "fabrique.social.gouv.fr"
