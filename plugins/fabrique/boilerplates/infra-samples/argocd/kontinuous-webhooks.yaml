apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: kontinuous-webhooks
spec:
  generators:
  - list:
      elements:
      # - rancherProjectName: archifiltre
      # - rancherProjectName: carnetdebord
      # - rancherProjectName: cdtn
      # - rancherProjectName: covid
      # - rancherProjectName: domifa
      # - rancherProjectName: dora
      # - rancherProjectName: egapro
      # - rancherProjectName: emjpm
      # - rancherProjectName: enfants-du-spectacle
      # - rancherProjectName: fabrique
      # - rancherProjectName: fce
      # - rancherProjectName: les1000jours
      # - rancherProjectName: mano
      # - rancherProjectName: monpsy
      # - rancherProjectName: monsuivipsy
      # - rancherProjectName: ozensemble
      # - rancherProjectName: reva
      - rancherProjectName: sample-next-app
      # - rancherProjectName: transition-collective
      # - rancherProjectName: tumeplay
      # - rancherProjectName: ressourcerie
      # - rancherProjectName: secretariat
  template:
    metadata:
      name: 'kontinuous-webhook-{{rancherProjectName}}'
    spec:
      project: kontinuous
      source:
        path: packages/webhook
        repoURL: https://github.com/SocialGouv/kontinuous.git
        targetRevision: master
        helm:
          parameters:
            - name: "ciNamespace"
              value: "{{rancherProjectName}}-ci"
            - name: "host"
              value: "webhook-{{rancherProjectName}}.fabrique.social.gouv.fr"
              # value: "webhook-{{ .Values.rancherProjectName }}.{{ .Values.baseDomain }}"
      destination:
        name: prod
        namespace: "webhook-{{rancherProjectName}}"